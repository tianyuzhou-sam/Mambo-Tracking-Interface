# RTD_Mambo_interface

This is the Python interface for RTD and the Parrot [Mambo](https://www.parrot.com/us/drones/parrot-mambo-fpv) Quadrotor.


**1.Dependencies**
**RTD_Mambo_interface** has been tested on Ubuntu 18.04.4 LTS with Python 3.6.9. Your Python version should satisfy all the version requirements of dependencies. Here is the version list of all dependencies this repository uses:
Python (3.6.9)
numpy (1.17.0)
scipy (1.3.0)
transforms3d (0.3.1)
matplotlib (3.1.1)
pyparrot (1.5.20)
owl (5.1.279)

Feel free to use your favorite Python package manager to install all the dependency packages. In addition, [pip](https://pip.pypa.io/en/stable/) can install the required packages by typing the following command in the terminal:
```
sudo pip3 install numpy scipy transforms3d matplotlib
```

To install [pyparrot](https://github.com/amymcgovern/pyparrot), you can follow the official documentation [website](https://pyparrot.readthedocs.io/en/latest/installation.html).

**RTD_Mambo_interface** utilizes [PhaseSpace](https://www.phasespace.com/) Motion Capture System for the state estimation. Since we are unable to distribute its Python API named `owl.py` here, you will have to copy `owl.py` under the file folder `owl.py` by yourselves. Feel free to change the state estimation function to utilize your own motion capture system and interface.


**2. Path Configuration**
Assume you are currently under the main directory of **RTD_Mambo_interface**, then create a directory named `traj_csv_files` by
```
cd <MainDirectory>
mkdir traj_csv_files
```

This directory `traj_csv_files` stores the desired trajectories csv files generated by quadrotor_RTD in 2 Hz, and **RTD_Mambo_interface** reads the latest csv file as the desired trajectory in 10 Hz. When the interface is initializing, it will delete all the files in this directory and make sure there are only trajectories files under this trajectory when the controller is running.


**3. Communication with PhaseSpace and MATLAB RTD**
This project uses mocap for absolute positions and attitudes. Between mocap and LLC (Low-Level Controller, i.e LLC.py), the communication is via TCP/IP. You need to start mocap first, and then run LLC. If the drone is flying outside the mocap region, you can’t get any new data in TCP/IP and all the scripts will wait for new data. So the callback function get_states_mocap() in helper_function.py will land the drone immediately for the safety. The default host and port are ‘127.0.0.1’ (equivalent to ‘localhost’) and 9000. The communication between MATLAB and LLC is via UDP. LLC provides the positions and velocities of the drone to MATLAB. The default host and port are ‘127.0.0.1’ (equivalent to ‘localhost’) and 11000.

Sometimes you may want to shut down the current mocap.py and LLC.py and rerun them, but you may get errors like “The current port is occupied.” You can either wait for a few minutes or change the port value accordingly. But do not mess up with the different ports.





**4. How to run this interface**
Open Terminal 1, type
```
cd <MainDirectory>/src
python3 mocap.py
```

Open Terminal 2, type
```
cd <MainDirectory>/src
python3 LLC.py
```

After you see the related message in Terminal 2, run the quadrotor_RTD planner via MATLAB.



**To-do**

sysid data
Desired yaw

